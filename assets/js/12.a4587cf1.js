(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{492:function(s,t,a){"use strict";a.r(t);var n=a(4),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"深入学习jvm的内存结构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#深入学习jvm的内存结构"}},[s._v("#")]),s._v(" 深入学习JVM的内存结构")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://bee71-1302549720.cos.ap-shanghai.myqcloud.com/1582548867936-2156034a-3f00-451c-be84-2f4b4e32efe1.png",alt:""}})]),s._v(" "),a("h2",{attrs:{id:"_1-程序计数器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-程序计数器"}},[s._v("#")]),s._v(" 1.程序计数器")]),s._v(" "),a("p",[s._v("全称："),a("code",[s._v("Program Counter Register")]),s._v("（物理上是"),a("strong",[s._v("寄存器")]),s._v("实现的，读取速度非常快。）")]),s._v(" "),a("h3",{attrs:{id:"_1-1-作用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-作用"}},[s._v("#")]),s._v(" 1-1.作用")]),s._v(" "),a("ul",[a("li",[s._v("每个线程都拥有一个程序计数器，是"),a("strong",[s._v("线程私有")]),s._v("的！")]),s._v(" "),a("li",[s._v("用来"),a("strong",[s._v("存储指向下一条指令的地址")]),s._v("。")]),s._v(" "),a("li",[s._v("执行本地方法的时候，程序计数器的值是"),a("code",[s._v("undefined")]),s._v("。")])]),s._v(" "),a("h3",{attrs:{id:"_1-2-特点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-特点"}},[s._v("#")]),s._v(" 1-2.特点")]),s._v(" "),a("ul",[a("li",[a("p",[a("strong",[s._v("是线程私有的")]),s._v("。")])]),s._v(" "),a("li",[a("p",[s._v("是一块较小的内存空间，所以"),a("strong",[s._v("不会存在内存溢出")]),s._v("。")])])]),s._v(" "),a("h2",{attrs:{id:"_2-虚拟机栈"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-虚拟机栈"}},[s._v("#")]),s._v(" 2.虚拟机栈")]),s._v(" "),a("p",[s._v("全称："),a("code",[s._v("JVM Stacks")])]),s._v(" "),a("h3",{attrs:{id:"_2-1-定义"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-定义"}},[s._v("#")]),s._v(" 2-1.定义")]),s._v(" "),a("img",{staticStyle:{zoom:"50%"},attrs:{src:"https://bee71-1302549720.cos.ap-shanghai.myqcloud.com/1582599163137-16cc9615-0ed1-46ba-8645-4b99807327b8.png"}}),s._v(" "),a("ul",[a("li",[a("p",[s._v("虚拟机栈就是"),a("strong",[s._v("线程运行时需要的内存空间")]),s._v("。虚拟机栈是"),a("strong",[s._v("线程私有")]),s._v("的，每创建一个线程，虚拟机就会为这个线程创建一个虚拟机栈。")])]),s._v(" "),a("li",[a("p",[s._v("一个栈内又由多个"),a("strong",[s._v("栈帧")]),a("code",[s._v("frame")]),s._v("组成。")])]),s._v(" "),a("li",[a("p",[s._v("栈帧用来保存一个方法的"),a("strong",[s._v("局部变量")]),s._v("，"),a("strong",[s._v("操作数栈")]),s._v("（Java没有寄存器，所有的参数传递都通过操作数栈），常量池指针，动态链接，方法返回值等。")])]),s._v(" "),a("li",[a("p",[s._v("**每一次方法调用都会创建一个栈帧，并压栈。**退出方法的时候，修改栈顶指针就可以把栈帧内容销毁。")])]),s._v(" "),a("li",[a("p",[s._v("每个线程只能有一个"),a("strong",[s._v("活动栈帧")]),s._v("。它对应着当前正在执行的那个方法。")])])]),s._v(" "),a("h3",{attrs:{id:"_2-2-优缺点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-优缺点"}},[s._v("#")]),s._v(" 2-2.优缺点")]),s._v(" "),a("ul",[a("li",[s._v("优点：存取速度比堆快，仅次于寄存器。")]),s._v(" "),a("li",[s._v("缺点：存在栈中的数据大小，生存期是在编译器决定的，缺乏灵活性。")])]),s._v(" "),a("h3",{attrs:{id:"_2-3-思考"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-思考"}},[s._v("#")]),s._v(" 2-3.思考")]),s._v(" "),a("p",[a("strong",[s._v("1.垃圾回收是否涉及栈内存呢？")]),s._v("\n答：不涉及，因为虚拟机栈就是一次次的方法调用组成的，当方法执行结束后，栈帧内存会随着出栈自动释放掉。")]),s._v(" "),a("p",[a("strong",[s._v("2.栈内存是否分配的越大越好？")]),s._v("\n答：不是的。栈内存分配的越大，反而会让线程的执行数变少。因为物理内存的大小是一定的。")]),s._v(" "),a("p",[a("strong",[s._v("3.方法内的局部变量是否是线程安全的？")]),s._v("\n答：先看下面的代码：")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Demo01")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("m1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    \t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" x "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" i "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        \tx"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("x"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[s._v("有一个局部变量x,方法m1对x变量自增5000次。如果这时有多个线程执行此方法。会产生线程安全问题吗？")]),s._v(" "),a("p",[a("strong",[s._v("答案是不会。")])]),s._v(" "),a("p",[s._v("从图中可以看出，当两个线程都执行此方法时，分别会创建两个局部变量的栈帧入栈。相当于每个线程都有自己私有的变量x,互不干扰。（"),a("strong",[s._v("局部变量是线程私有的")]),s._v("）")]),s._v(" "),a("p",[s._v("如果把"),a("code",[s._v("x")]),s._v("设置为静态变量，如果不加保护，就会产生线程安全问题。")]),s._v(" "),a("hr"),s._v(" "),a("p",[s._v("再来深入分析一下，看下面这段代码：")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Demo02")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("main")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" args"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    \t\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    \n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("m1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    \t"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("StringBuilder")]),s._v(" sb "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("StringBuilder")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        sb"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("append")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        sb"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("append")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        sb"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("append")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sb"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("toString")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    \n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//sb作为参数传递进来")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("m2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("StringBuilder")]),s._v(" sb"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    \tsb"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("append")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        sb"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("append")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        sb"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("append")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sb"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("toString")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    \n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("m3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    \t"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("StringBuilder")]),s._v(" sb "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("StringBuilder")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        sb"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("append")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        sb"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("append")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        sb"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("append")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//sb作为一个对象返回了")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" sb"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br")])]),a("p",[s._v("在m1方法里，"),a("code",[s._v("sb")]),s._v("是方法里的局部变量，是线程私有的，所以是线程安全的。")]),s._v(" "),a("p",[s._v("在m2方法里，"),a("code",[s._v("sb")]),s._v("作为了一个参数传递进来，这就意味着有其他的线程能访问到它，就不是线程私有的了，是共享的了，就会存在线程安全问题。可以用"),a("code",[s._v("StringBuffer")]),s._v("解决这个问题。")]),s._v(" "),a("p",[s._v("在m3方法里，"),a("code",[s._v("sb")]),s._v("对象作为一个返回值返回了，这意味着其他线程也能获取到这个对象且并发地修改它。所以也存在线程安全问题。")]),s._v(" "),a("p",[s._v("综上所述，"),a("strong",[s._v("要判断一个局部变量是否是线程安全的，就要看它有没有逃离该方法的作用范围")]),s._v("。")]),s._v(" "),a("h3",{attrs:{id:"_2-4-栈内存溢出"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-栈内存溢出"}},[s._v("#")]),s._v(" 2-4.栈内存溢出")]),s._v(" "),a("p",[a("code",[s._v("java.lang.StackOverFlowError")])]),s._v(" "),a("p",[a("strong",[s._v("什么情况会导致内存溢出呢？")])]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("栈帧过多")]),s._v("（比如递归调用，如果没有设置正确的结束条件，就会导致内存溢出）。")]),s._v(" "),a("li",[s._v("栈帧过大（这种情况极少出现）。")])]),s._v(" "),a("div",{staticClass:"language-MARKDOWN line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-markdown"}},[a("code",[s._v("可以通过 -Xss256k 来设置虚拟机栈的内存大小。\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h2",{attrs:{id:"_3-本地方法栈"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-本地方法栈"}},[s._v("#")]),s._v(" 3.本地方法栈")]),s._v(" "),a("p",[s._v("全称："),a("code",[s._v("Native Method Stacks")])]),s._v(" "),a("p",[s._v("本地方法就是值那些不是由Java编写的代码。有时候需要借助C语言等和操作系统的底层打交道。")]),s._v(" "),a("h2",{attrs:{id:"_4-堆"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-堆"}},[s._v("#")]),s._v(" 4.堆")]),s._v(" "),a("p",[s._v("全称："),a("strong",[s._v("Heap")])]),s._v(" "),a("h3",{attrs:{id:"定义"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#定义"}},[s._v("#")]),s._v(" 定义")]),s._v(" "),a("p",[s._v("通过new关键字，创建对象都会使用到堆内存。")]),s._v(" "),a("h3",{attrs:{id:"特点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#特点"}},[s._v("#")]),s._v(" 特点")]),s._v(" "),a("ol",[a("li",[s._v("它是线程共享的，堆中对象都需要考虑线程安全的问题。")]),s._v(" "),a("li",[s._v("具有垃圾回收机制。")])]),s._v(" "),a("h3",{attrs:{id:"堆内存溢出"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#堆内存溢出"}},[s._v("#")]),s._v(" 堆内存溢出")]),s._v(" "),a("p",[a("code",[s._v("java.lang.OutOfMemeoryError")]),s._v(" 就是指的堆内存溢出。（heap space）")]),s._v(" "),a("p",[s._v("参数：-XMX（最大堆空间内存）")]),s._v(" "),a("h3",{attrs:{id:"堆内存诊断"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#堆内存诊断"}},[s._v("#")]),s._v(" 堆内存诊断")]),s._v(" "),a("p",[a("strong",[s._v("1.jps工具")])]),s._v(" "),a("ul",[a("li",[s._v("查看当前系统中有哪些java进程")])]),s._v(" "),a("p",[a("strong",[s._v("2.jmap工具")])]),s._v(" "),a("ul",[a("li",[s._v("查看堆内存占用情况（命令行语句：jmap -heap 进程id）")])]),s._v(" "),a("p",[a("strong",[s._v("3.jconsole工具")])]),s._v(" "),a("ul",[a("li",[s._v("图形界面的多功能检测工具，可以连续检测")])]),s._v(" "),a("p",[a("strong",[s._v("4.jvisualvm工具")])]),s._v(" "),a("ul",[a("li",[s._v("可视化的虚拟机")])]),s._v(" "),a("h2",{attrs:{id:"_5-方法区"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-方法区"}},[s._v("#")]),s._v(" 5.方法区")]),s._v(" "),a("p",[s._v("全称：Method Area")]),s._v(" "),a("h3",{attrs:{id:"定义-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#定义-2"}},[s._v("#")]),s._v(" 定义")]),s._v(" "),a("p",[s._v("方法区是"),a("strong",[s._v("各个线程共享的区域")]),s._v("，用于存储已经被虚拟机加载的类信息、常量、静态常量、即时编译器编译后的代码等数据。比如成员变量、方法数据、成员方法以及构造器方法的代码部分。")]),s._v(" "),a("p",[s._v("综上，方法区存储的就是跟类相关的一些信息。")]),s._v(" "),a("p",[a("strong",[s._v("方法区是在java虚拟机启动时创建的")]),s._v("。尽管逻辑上方法区是堆的一部分，但在实现上不同的虚拟机有各自的实现方式。")]),s._v(" "),a("p",[s._v("在jdk1.8以前,方法区的实现方式是"),a("strong",[s._v("永久代")]),s._v("，在1.8以后，就把永久代移除了，换了个实现方式叫"),a("strong",[s._v("元空间")]),s._v("。元空间用的就是"),a("strong",[s._v("本地内存")]),s._v("，也就是操作系统的内存。")]),s._v(" "),a("p",[s._v("具体结构看下图：\n"),a("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2020/png/616319/1582690595898-f49c1755-4dd3-42af-8fb8-dbe8d722a147.png#align=left&display=inline&height=293&name=QQ%E5%9B%BE%E7%89%8720200226114706.png&originHeight=338&originWidth=602&size=65920&status=done&style=none&width=521",alt:"QQ图片20200226114706.png"}}),s._v("\n这里的方法区只是一个概念，实现的方式是永久代。\n"),a("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2020/png/616319/1582690675751-2931cb45-dc3c-4464-a3af-f63cef618390.png#align=left&display=inline&height=327&name=QQ%E5%9B%BE%E7%89%8720200226114711.png&originHeight=327&originWidth=896&size=87315&status=done&style=none&width=896",alt:"QQ图片20200226114711.png"}}),s._v("\n1.8后，方法区的实现方式变成了元空间，元空间是由本地内存管理了，不在堆内存了。StringTable移到了堆内存中了。")]),s._v(" "),a("h3",{attrs:{id:"方法区内存溢出"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#方法区内存溢出"}},[s._v("#")]),s._v(" 方法区内存溢出")]),s._v(" "),a("p",[s._v("方法区如果内存不足了，也会抛出一个OutOfMemory的异常。")]),s._v(" "),a("blockquote",[a("p",[s._v("1.8以前会导致永久代内存溢出，1.8以后会导致元空间内存溢出")])]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*\n* 演示元空间内存溢出\n* -XX:MaxMetaSpaceSize=8m\n*/")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Demo03")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("extends")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ClassLoader")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//可以用来加载类的二进制字节码")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("main")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" args"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" j "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Demo03")]),s._v(" test "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Demo03")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" i "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" j"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//ClassWriter 作用是生成类的二进制字节码")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ClassWriter")]),s._v(" cw "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ClassWriter")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//版本号, 修饰符public, 类名, 包名, 父类, 接口")]),s._v("\n                cw"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("visit")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Opcodes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("V1_8"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Opcodes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ACC_PUBLIC"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Class"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" i"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"java/lang/Object"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//返回byte[]")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("byte")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" code "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" cw"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("toByteArray")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//执行了类的加载")]),s._v("\n                test"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("defineClass")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Class"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" i"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("length"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("finally")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("j"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br")])]),a("p",[s._v("看上图的代码，如果我们把虚拟机参数云空间最大容量改为8M。就会抛出内存溢出异常。\n"),a("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2020/png/616319/1584665688069-b06bf156-322a-47f0-94c9-8bfab75fe6aa.png#align=left&display=inline&height=160&name=QQ%E5%9B%BE%E7%89%8720200320085423.png&originHeight=160&originWidth=548&size=96158&status=done&style=none&width=548",alt:"QQ图片20200320085423.png"}}),s._v("\n1.8以前，会显示永久代内存溢出：java.lang.OutOfMemory: Permgen space")]),s._v(" "),a("h3",{attrs:{id:"运行时常量池"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#运行时常量池"}},[s._v("#")]),s._v(" 运行时常量池")]),s._v(" "),a("p",[a("strong",[s._v("先来聊聊什么叫常量池？")]),s._v(" "),a("strong",[s._v("常量池")]),s._v("其实就是一张表，虚拟机指令会根据这张表来找到要执行的类名、方法名、参数类型、字面量（比如字符串之类的）等信息。")]),s._v(" "),a("p",[s._v("我们可以拿经典代码hello world为例子来学习常量池。如果我们要运行这个程序，肯定首先要把它编译成二进制字节码。\n二进制字节码由以下几部分组成：")]),s._v(" "),a("ul",[a("li",[s._v("类的基本信息")]),s._v(" "),a("li",[s._v("常量池")]),s._v(" "),a("li",[s._v("类中的方法定义（类的方法中就包含了虚拟机指令）")])]),s._v(" "),a("p",[s._v("首先我们要对二进制字节码文件进行反编译：javap -v HelloWorld.class\n"),a("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2020/png/616319/1584668512674-7865887a-ba4c-4f9d-98d0-2364e53c163e.png#align=left&display=inline&height=113&name=QQ%E5%9B%BE%E7%89%8720200320094134.png&originHeight=113&originWidth=360&size=5939&status=done&style=none&width=360",alt:"QQ图片20200320094134.png"}}),s._v("\n这几行就是方法中的虚拟机指令。比如第一行获取静态变量，那么我们要怎么获取呢？这时候我们就要根据后边的#7去常量池查表。\n"),a("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2020/png/616319/1584669058933-d6ad5a2b-b31c-4c41-8b78-70c8025c74be.png#align=left&display=inline&height=166&name=QQ%E5%9B%BE%E7%89%8720200320095049.png&originHeight=166&originWidth=1081&size=24085&status=done&style=none&width=1081",alt:"QQ图片20200320095049.png"}}),s._v("\n查到#7是fieldref——引用了成员变量。指向#8和#9，那么就继续找。#8是类名，我们要找哪个类的成员变量呢？继续找#10。接下来都是如此。。。")]),s._v(" "),a("p",[a("strong",[s._v("运行时常量池")]),s._v("是方法区的一部分，是java虚拟机在完成类装载操作后，将"),a("strong",[s._v("class文件中的常量池载入到内存中")]),s._v("，并保存在方法区中。")]),s._v(" "),a("p",[s._v("常量池是*.class文件中的，当该类被加载，它的常量池信息就会被放入运行时常量池。并把里面的符号地址变为真实地址。")]),s._v(" "),a("h3",{attrs:{id:"stringtable"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#stringtable"}},[s._v("#")]),s._v(" StringTable")]),s._v(" "),a("p",[s._v("中文名就是我们俗称的串池（字符串常量池），是运行时常量池的重要组成部分。它存在于堆中（JDK1.7之后）。\nStringTable存在着"),a("strong",[s._v("hash表的特性")]),s._v("，不存在两个相同的字符串，也不能扩容。")]),s._v(" "),a("p",[s._v("先看下面这个例子：")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Demo04")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("main")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" args"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" s1 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"a"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" s2 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"b"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" s3 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ab"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("常量池中的信息，都会被加载到运行时常量池中。这时a、b和ab都是常量池中的符号，还没有变为java字符串对象。\n创建java字符串对象的时候，就会把该对象放入StringTable中。")]),s._v(" "),a("p",[s._v("看下面这道经典的面试题，搞懂了这道面试题，也就搞懂了StringTable。")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[s._v("    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("main")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" args"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" str1 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"abc"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" str2 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ab"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"c"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" str3 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ab"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"c"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" str4 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" str3"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("intern")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("str1 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" str2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("str1 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" str3"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("str1 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" str4"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[s._v("分别分析3个输出结果：")]),s._v(" "),a("ol",[a("li",[s._v("第一个输出为true。原因是JVM"),a("strong",[s._v("存在编译器优化的机制")]),s._v("。在编译期（javac  *.java时）会将可以拼接的"),a("strong",[s._v("字符串常量")]),s._v('帮你自动拼接了，此时由于StringTable中已经存在了"abc"这个字符串对象，因此会让str2指向一个与str1相同的那块地址，因此为true。')]),s._v(" "),a("li",[s._v("第二个输出为false。由于使用了new String( )，运行过程中会在堆中重新开辟一个空间存储，与之前的常量字符串没啥关系，因此为false。")]),s._v(" "),a("li",[s._v("第三个输出为true，原因调用"),a("strong",[s._v("intern( )方法")]),s._v("时会把在StringTable中查找是否存在与其值相等的（并不是地址相等）的字符串，发现里面恰好存在，因此返回该存在的引用，StringTable中的就是str1，因此为true。")])]),s._v(" "),a("h2",{attrs:{id:"_6-直接内存"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-直接内存"}},[s._v("#")]),s._v(" 6.直接内存")]),s._v(" "),a("p",[s._v("全称："),a("code",[s._v("Direct Memory")])]),s._v(" "),a("h3",{attrs:{id:"定义-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#定义-3"}},[s._v("#")]),s._v(" 定义")]),s._v(" "),a("p",[s._v("直接内存并"),a("strong",[s._v("不是虚拟机运行时数据区的一部分")]),s._v("，也"),a("strong",[s._v("不是Java 虚拟机规范中定义的内存区域")]),s._v("。")]),s._v(" "),a("ul",[a("li",[s._v("常见于NIO操作时，用作数据缓冲区。")]),s._v(" "),a("li",[s._v("分配回收成本较高，但是读写性能较好。")]),s._v(" "),a("li",[s._v("不受JVM内存回收管理。")])]),s._v(" "),a("blockquote",[a("p",[s._v("在JDK1.4中新加入了NIO（New Input/Output）类，引入了一种基于通道（Channel）与缓冲区（Buffer）的I/O方式。")])]),s._v(" "),a("h3",{attrs:{id:"基本使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#基本使用"}},[s._v("#")]),s._v(" 基本使用")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2020/png/616319/1583032205491-6dd1cba9-a900-4d70-a4d0-629c7ab417e4.png#align=left&display=inline&height=343&name=QQ%E5%9B%BE%E7%89%8720200301110420.png&originHeight=494&originWidth=699&size=116766&status=done&style=none&width=486",alt:"QQ图片20200301110420.png"}}),s._v("\n在文件读写过程中，java首先要调用操作系统内部的函数，它自己本身是不具备磁盘读写能力。首先辉仔啊系统内存中划出一块系统缓存区，但是在系统缓存区java代码是不能运行的，所以还要在堆里再划出一块java缓冲区。简洁读写磁盘文件。但是这里有两块缓冲区，从而会造成磁盘读写的效率不是很高。\n"),a("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2020/png/616319/1583032556654-92754838-8b88-426b-8f4f-a799030075e9.png#align=left&display=inline&height=353&name=QQ%E5%9B%BE%E7%89%8720200301110755.png&originHeight=518&originWidth=739&size=160194&status=done&style=none&width=504",alt:"QQ图片20200301110755.png"}}),s._v("\n在这张图里，也会在系统内存划出一块缓冲区，也就是我们讲的直接内存。但与上图不同的是，java代码也可以直接访问这块内存。所以直接内存是系统和java可以共享的一块区域。")]),s._v(" "),a("h3",{attrs:{id:"内存溢出"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#内存溢出"}},[s._v("#")]),s._v(" 内存溢出")]),s._v(" "),a("p",[s._v("直接内存也会存在内存溢出。异常是 "),a("code",[s._v("java.lang.OutOfMemory")]),s._v(" : Direct buffer memory")])])}),[],!1,null,null,null);t.default=e.exports}}]);